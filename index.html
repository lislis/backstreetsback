<html>
  <head>
    <!-- <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script> -->
    <script src="a-frame-dev.js"></script>

    <script>
     AFRAME.registerShader('brix', {
       schema: {},
       vertexShader: `
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
       `,
       fragmentShader: `
varying vec2 vUv;

void main() {
  float single = (mod(vUv[0], 0.09) * 60.0) * mod(vUv[1], 0.06) * 100.0;
  vec3 construct = vec3(single);

  construct.b = 0.3 * construct.r;
  construct.g = 0.3 * construct.r;

  gl_FragColor = vec4(construct, 1.0);
}
       `
     });
    </script>
  </head>
  <body>
    <a-scene fog="type: exponential; color: #333; density: 0.01" light="defaultLightsEnabled: false">
      <a-entity id="walls" position="0 0 0">
        <a-entity  position="-7 4 -12" geometry="primitive: box; width: 10; height: 8" material=""></a-entity>
        <a-entity  position="-2 4 -5" geometry="primitive: box; width: 15; height: 8" rotation="0 -90 0" material=""></a-entity>
        <a-entity position="-12 7 -4" geometry="width: 8; height: 15; depth: 12" rotation="0 -90 0" material=""></a-entity>
        <a-entity position="-12 4 4" geometry="width: 15; height: 8" rotation="0 -90 0" material=""></a-entity>
        <a-entity position="-5 4 11" geometry="width: 15; height: 8" rotation="" material=""></a-entity>
        <a-entity position="-2 10.85 12" geometry="width: 8; height: 22; depth: 12" rotation="" material=""></a-entity>
        <a-entity position="4 4 11" geometry="width: 15; height: 8" rotation="" material=""></a-entity>
        <a-entity position="1 6 0" geometry="width: 8; height: 14; depth: 5" rotation="" material=""></a-entity>
        <a-entity position="11 4 0" geometry="width: 23; height: 8" rotation="0 90 0" material=""></a-entity>
        <a-entity position="7 10 -11" geometry="width: 10; height: 22; depth: 12" rotation="" material=""></a-entity>
      </a-entity>

      <a-entity position="-14 1.6 -10" rotation="0 -90 0" id="player">
        <a-entity camera look-controls position="0 0 0">
          <a-entity  id="light" position="0 0 0" rotation="0 0 0" light="type: spot; color: #BBB; intensity: 0.4"></a-entity>
          </a-entity>
      </a-entity>

      <a-plane id="floor" position="0 0 0" rotation="-90 0 0" width="30" height="30" color="#4a3d39"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>


    <script>
     var playerEl = document.querySelector('#player');

     const checkpoints = {
       1: {
         a: 'x',
         p: {x: -12}
       },
       2: {
         a: 'x',
         p: {x: -5},
       },
       3: {
         a: 'z',
         p: {z: 3},
       },
       4: {
         a: 'x',
         p: {x: -8},
       },
       5: {
         a: 'z',
         p: {z: 7},
       },
       6: {
         a: 'z',
         p: {z: 3},
       },
       7: {
         a: 'x',
         p: {z: 3},
       },
       8: {
         a: 'z',
         p: {z: 7.5},
       },
       9: {
         a: 'x',
         p: {x: 7.5},
       },
       10: {
         a: 'z',
         p: {z: -4},
       },
       11: {
         a: 'x',
         p: {x: 0},
       },
       12: {
         a: 'z',
         p: {z: -14}
       }
     }

     let state = {
       current: 1,
       speed: 0.05
     }

     function checkAxis (current) {
       let axis = current.a;
       let pos = current.p;
       let player_ax = playerEl.object3D.position[axis];
       let goal_ax = pos[axis];

       if (player_ax <= goal_ax) {
         playerEl.object3D.position[axis] += state.speed;
       } else if (player_ax >= goal_ax) {
         playerEl.object3D.position[axis] -= state.speed;
       }

       if (playerEl.object3D.position[axis].toFixed(2) == goal_ax) {
         return true;
       } else {
         return false;
       }
     }

     function handlePosition () {
       let current = checkpoints[state.current];

       if (current) {
         let checked = checkAxis(current);
         if (checked) {
           state.current += 1;
         }
       } else {
         console.log("ALRIGHT")
       }
     }


     function moveCam(dt) {
       handlePosition();
       window.requestAnimationFrame(moveCam);
     }
     let aF = window.requestAnimationFrame(moveCam);

    </script>
  </body>
</html>
